Последний вопрос --- как сэмплировать термальные скорости.

Будем считать, что форм фактор $f(q,v)$ медленно меняется и его можно сэмплировать мажорантой $f(q,v) = const$.

Остается только часть с $\vec{v}_1$. В вероятность входит величина 

$$
|\vec{v}_1' - \vec{V}'| 2\pi \cfrac{v_1^2}{(2\pi)^{3/2} v_T^3} dv_1 e^{-v_1^2/2v_T^2} d\cos{\theta} = \sqrt{ v_1^2 + V^2 - 2 v_1 V \cos{\theta} \pm \Delta^2 } \frac{ v_1^2}{v_T^3 \sqrt{2\pi}} dv_1 e^{-v_1^2/2v_T^2} d\cos{\theta}
$$

Существует несколько случаев
\begin{itemize}
	\item $+\Delta^2$ либо $-\Delta^2$, но $v_1 > V+\Delta$ либо $0 < v_1 < V-\Delta$
	
	Тогда $\cos{\theta}$ меняется от $-1$ до $1$. 
	
	\item $-\Delta^2$ и $|\Delta - V| < v_1 < V+\Delta$
	
	Тогда  $\cos{\theta}$ меняется от $-1$ до $\cos{\theta}^{max}$
\end{itemize}

В первом случае берется интеграл по $\cos{\theta}$. Он имеет вид
$$
	\sqrt{A - B y} dy = dG(y) 	
$$
где 
$$
	G(y) = 2\frac{(A+B)^{3/2} - (A-By)^{3/2}}{3B}
$$
Остюда легко сэмлировать $y$, обращая $G(y)/G(1)$

$$
\xi_{\theta} = \frac{G(y)}{G(1)} = \cfrac{(1+t)^{3/2} - (1-t y)^{3/2}} {(1+t)^{3/2} - (1-t )^{3/2}}, t = \frac{B}{A} < 1
$$

$$
	y = \cfrac{1 - ( (1+t)^{3/2} - \xi \left[ (1+t)^{3/2}-(1-t)^{3/2}\right] )^{2/3} }{t}
$$
Далее наш интеграл свелся к 

$$
G(1) \frac{ v_1^2}{v_T^3\sqrt{2\pi}} dv_1 e^{-v_1^2/2v_T^2} d\xi_{\theta}
$$

$$G(1) =2 \sqrt{A} \cdot \left[ Q(t=B/A) = \cfrac{(1 + t)^{3/2} - (1 - t)^{3/2}}{3t} \right]$$

$$
 = G(1) \sqrt{\cfrac{u}{\pi}} e^{-u}du
$$

Теперь рассмотрим эндотермический случай, когда $v \in [|V-\Delta|, V+\Delta]$.
тогда $\cos{\theta}$ ограничен $\cos{\theta}^{max}$
$$
	\cos{\theta}^{max} = \cfrac{V^2+v_1^2-\Delta^2}{2 V v_1} = A/B = t
$$

тогда вместо $G(1)$ будет стоять $G(y^{max}) = 2 (A+B)^{3/2}/3B = 2/3\sqrt{B} (t+1)^{3/2}$ 

$$
\xi_{\theta} = \frac{G(y)}{G(y^{max})} = \cfrac{(t+1)^{3/2} - (t - y)^{3/2}} {(1+t)^{3/2}}
$$

$$
	y = t - \left( (1+t)^{3/2} (1-\xi) \right)^{2/3}
$$